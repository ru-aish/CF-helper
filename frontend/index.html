<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Codeforces AI Tutor</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="theme-dark">
    <div class="app-shell">
        <!-- Sidebar (ChatGPT-like) -->
        <aside class="sidebar">
            <div class="sidebar-top">
                <button id="new-chat-btn" class="sidebar-btn primary">
                    <i class="fa-solid fa-plus"></i>
                    <span>New Chat</span>
                </button>
            </div>
            <div class="sidebar-section">
                <div class="sidebar-section-title">Conversations</div>
                <div id="conversations-list" class="conversations-list">
                    <!-- Conversations rendered here -->
                </div>
            </div>
            <div class="sidebar-bottom">
                <button id="theme-toggle" class="icon-btn" title="Toggle theme">
                    <i class="fa-solid fa-moon"></i>
                </button>
                <a href="https://codeforces.com" target="_blank" class="icon-btn" title="Open Codeforces">
                    <i class="fa-solid fa-arrow-up-right-from-square"></i>
                </a>
            </div>
        </aside>

        <!-- Main area -->
        <main class="main">
            <!-- Topbar (simplified header without URL bar) -->
            <header class="topbar">
                <div class="brand">
                    <i class="fa-solid fa-graduation-cap"></i>
                    <span>Codeforces AI Tutor</span>
                </div>
                <div class="topbar-right">
                    <span id="session-id-display" class="subtle"></span>
                </div>
            </header>

            <!-- Problem quick bar (appears after extraction) -->
            <section id="problem-bar" class="problem-bar hidden">
                <div class="problem-meta-left">
                    <div class="problem-title-row">
                        <span id="problem-title" class="problem-title"></span>
                        <a id="problem-open-link" href="#" target="_blank" class="icon-link" title="Open on Codeforces"><i class="fa-solid fa-up-right-from-square"></i></a>
                    </div>
                    <div id="problem-contest" class="problem-contest"></div>
                </div>
                <div class="problem-meta-right">
                    <span id="time-limit" class="pill"></span>
                    <span id="memory-limit" class="pill"></span>
                    <div id="tags" class="tags"></div>
                    <button id="view-problem-btn" class="chip" title="View statement and samples"><i class="fa-regular fa-file-lines"></i></button>
                </div>
            </section>

            <!-- Chat thread -->
            <section class="chat-thread" id="session-section">
                <div id="chat-messages" class="chat-messages"></div>

                <!-- Composer -->
                <div class="composer">
                    <div class="composer-row">
                        <textarea id="chat-input" rows="1" placeholder="Message Codeforces Tutorâ€¦ (Shift+Enter = newline)"></textarea>
                        <div class="composer-actions">
                            <button id="get-hint-btn" class="chip" title="Get progressive hint"><i class="fa-regular fa-lightbulb"></i></button>
                            <button id="get-solution-btn" class="chip" title="Reveal solution"><i class="fa-solid fa-key"></i></button>
                            <button id="analyze-code-btn" class="chip" title="Analyze my code"><i class="fa-solid fa-code"></i></button>
                            <button id="regenerate-btn" class="chip" title="Regenerate answer"><i class="fa-solid fa-rotate-right"></i></button>
                            <button id="stop-btn" class="chip danger" title="Stop generating" disabled><i class="fa-solid fa-stop"></i></button>
                            <button id="send-btn" class="btn btn-primary"><i class="fa-solid fa-paper-plane"></i></button>
                        </div>
                    </div>
                    <div class="composer-hint" id="hints-counter">Hints given: 0</div>
                </div>
            </section>

            <!-- Modals -->
            <div id="code-input-modal" class="modal hidden">
                <div class="modal-content wide">
                    <div class="modal-header">
                        <h3><i class="fa-solid fa-code"></i> Submit Your Code for Analysis</h3>
                        <span class="close">&times;</span>
                    </div>
                    <div class="modal-body">
                        <textarea id="student-code" placeholder="Paste your C++, Java, or Python code here..."></textarea>
                    </div>
                    <div class="modal-actions">
                        <button id="cancel-code-btn" class="btn btn-secondary">Cancel</button>
                        <button id="submit-code-btn" class="btn btn-primary">
                            <i class="fa-solid fa-paper-plane"></i> Submit for Analysis
                        </button>
                    </div>
                </div>
            </div>

            <div id="problem-details-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="pd-title"><i class="fa-solid fa-file-lines"></i> Problem Details</h3>
                        <span class="close">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div id="pd-statement" class="problem-statement">Loading problem details...</div>
                        <div id="pd-samples" class="sample-tests"></div>
                    </div>
                </div>
            </div>

            <div id="solution-modal" class="modal hidden">
                <div class="modal-content wide">
                    <div class="modal-header">
                        <h3><i class="fa-solid fa-key"></i> Complete Solution</h3>
                        <span class="close">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div id="solution-explanation" class="solution-explanation">
                        </div>
                        <div id="solution-code-blocks" class="solution-code-blocks">
                        </div>
                    </div>
                </div>
            </div>

            <div id="new-problem-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fa-solid fa-link"></i> Start New Problem</h3>
                        <span class="close">&times;</span>
                    </div>
                    <div class="modal-body">
                        <p class="subtle" style="margin-bottom: 16px;">Enter the Codeforces problem URL to start a new learning session.</p>
                        <input type="url" id="modal-problem-url" class="url-input" placeholder="https://codeforces.com/contest/2135/problem/C" style="width: 100%; margin-bottom: 16px;">
                        <div id="modal-loading" class="loading hidden"><i class="fas fa-spinner fa-spin"></i> Extracting problem data...</div>
                        <div id="modal-error" class="error hidden"></div>
                    </div>
                    <div class="modal-actions">
                        <button id="cancel-problem-btn" class="btn btn-secondary">Cancel</button>
                        <button id="submit-problem-btn" class="btn btn-primary">
                            <i class="fa-solid fa-play"></i> Start Session
                        </button>
                    </div>
                </div>
            </div>

            <!-- Loading and Error States -->
            <div id="global-loading" class="loading hidden"><i class="fas fa-spinner fa-spin"></i> Processing...</div>
            <div id="global-error" class="error hidden"></div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.2/marked.min.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>
